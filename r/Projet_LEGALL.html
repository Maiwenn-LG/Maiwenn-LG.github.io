<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Projet</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="Projet_LEGALL_files/libs/clipboard/clipboard.min.js"></script>
<script src="Projet_LEGALL_files/libs/quarto-html/quarto.js"></script>
<script src="Projet_LEGALL_files/libs/quarto-html/popper.min.js"></script>
<script src="Projet_LEGALL_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Projet_LEGALL_files/libs/quarto-html/anchor.min.js"></script>
<link href="Projet_LEGALL_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Projet_LEGALL_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Projet_LEGALL_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Projet_LEGALL_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Projet_LEGALL_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Projet</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Projet d’apprentisssage statistique - M2 SNS - Maïwenn LE GALL</p>
<section id="préparation-du-jeu-de-données" class="level1">
<h1>Préparation du jeu de données</h1>
<p>Chargement du package <code>tidymodels</code>, qui servira pour la construction des algorithmes de prédiction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.2.0 ──</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>✔ broom        1.0.6     ✔ recipes      1.1.0
✔ dials        1.3.0     ✔ rsample      1.2.1
✔ dplyr        1.1.4     ✔ tibble       3.2.1
✔ ggplot2      3.5.1     ✔ tidyr        1.3.1
✔ infer        1.0.7     ✔ tune         1.2.1
✔ modeldata    1.4.0     ✔ workflows    1.1.4
✔ parsnip      1.2.1     ✔ workflowsets 1.1.0
✔ purrr        1.0.2     ✔ yardstick    1.3.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ purrr::discard() masks scales::discard()
✖ dplyr::filter()  masks stats::filter()
✖ dplyr::lag()     masks stats::lag()
✖ recipes::step()  masks stats::step()
• Use tidymodels_prefer() to resolve common conflicts.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yardstick)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(psych)     </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'psych' a été compilé avec la version R 4.4.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'psych'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:ggplot2':

    %+%, alpha</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:scales':

    alpha, rescale</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Le chargement a nécessité le package : lattice</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attachement du package : 'caret'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Les objets suivants sont masqués depuis 'package:yardstick':

    precision, recall, sensitivity, specificity</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>L'objet suivant est masqué depuis 'package:purrr':

    lift</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ROCR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'ROCR' a été compilé avec la version R 4.4.2</code></pre>
</div>
</div>
<section id="description-du-jeux-de-données" class="level2">
<h2 class="anchored" data-anchor-id="description-du-jeux-de-données">Description du jeux de données</h2>
<p>Le jeu de données utilisé est issu du site Kaggle.com (<a href="https://www.kaggle.com/datasets/gmadevs/atp-matches-dataset?select=atp_matches_2017.csv" class="uri">https://www.kaggle.com/datasets/gmadevs/atp-matches-dataset?select=atp_matches_2017.csv</a>). Il s’agit de résultats de tournois ATP de tennis (Association of Tennis Professionals Matches). Plus précisément, les données utilisées sont celles de matchs joués en 2017. On souhaite prédire la victoire ou non d’un joueur à partir d’informations sur le tournoi, sur le match, et sur le joueur et son adversaire.</p>
<p>La variable à expliquer est <code>player1_wins</code> qui prend la valeur TRUE ou FALSE.</p>
<p>Pour prédire le résulat du match on utilise les variables explicatives suivantes :</p>
<ul>
<li><p>Informations sur le match</p>
<ul>
<li><p>tourney_level : Niveau du tournoi (A : ATP 250, D: Coupe Davis, ou G : Grand Chelem)</p></li>
<li><p>surface : Surface du terrain (Hard : Dur, Clay : Terre battue, Carpet : Gazon)</p></li>
<li><p>round : tour du tournoi (F, SF, QF, R16, R32, R64, R128)</p></li>
<li><p>minutes : Durée du match</p></li>
</ul></li>
<li><p>Information sur les joueurs</p>
<ul>
<li><p>player1_rank_points et player2_rank_points : Nombre de points des joueurs au classement mondial</p></li>
<li><p>player1_age et player2_age : age des joueurs</p></li>
</ul></li>
<li><p>Informations sur les performances des joueurs au service</p>
<ul>
<li><p>player1_double_faults et player2_double_faults : nombre de double fautes commises par les joueurs au service.</p></li>
<li><p>player1_aces et player2_aces : nombre d’aces réalisés par les joueurs.</p></li>
</ul></li>
</ul>
</section>
<section id="importation-des-données" class="level2">
<h2 class="anchored" data-anchor-id="importation-des-données">Importation des données</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"C:</span><span class="sc">\\</span><span class="st">Users</span><span class="sc">\\</span><span class="st">maiwe</span><span class="sc">\\</span><span class="st">Documents</span><span class="sc">\\</span><span class="st">M2</span><span class="sc">\\</span><span class="st">Apprentissage stat"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Charger les données</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>tennis_data <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"atp_matches_2017.csv"</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>, <span class="at">dec =</span> <span class="st">"."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ré-organisation-des-données" class="level2">
<h2 class="anchored" data-anchor-id="ré-organisation-des-données">Ré-organisation des données</h2>
<p>Le jeu de données choisi posait quelques problèmes qui nécessitaient de l’organiser de manière différente. En effet, les joueurs et les données qui leur étaient associées étaient directement désignés par “loser” et “winner”. J’ai donc décidé de créer la variable à expliquer “player1_wins”, et de désigner les joueurs par joueur 1 et joueur 2.</p>
<p>On commence par définir de manière aléatoire si le joueur 1 désigne le gagnant du match ou non.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>total_matches <span class="ot">&lt;-</span> <span class="fu">nrow</span>(tennis_data)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>tennis_data<span class="sc">$</span>is_player1_winner <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>), total_matches, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On crée un nouveau jeu de données, en répartissant les données de manière à respecter le gagnant défini.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le nouveau dataframe</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Informations sur le match</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tourney_level =</span> tennis_data<span class="sc">$</span>tourney_level,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">surface =</span> tennis_data<span class="sc">$</span>surface,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">round =</span> tennis_data<span class="sc">$</span>round,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">minutes =</span> tennis_data<span class="sc">$</span>minutes,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Informations sur le joueur 1</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">player1_rank_points =</span> <span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, tennis_data<span class="sc">$</span>winner_rank_points, tennis_data<span class="sc">$</span>loser_rank_points),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">player1_age =</span> <span class="fu">round</span>(<span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, tennis_data<span class="sc">$</span>winner_age, tennis_data<span class="sc">$</span>loser_age),<span class="dv">1</span>),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">player1_hand =</span> <span class="fu">factor</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, <span class="fu">as.character</span>(tennis_data<span class="sc">$</span>winner_hand),</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(tennis_data<span class="sc">$</span>loser_hand)),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">levels</span>(tennis_data<span class="sc">$</span>winner_hand)</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>),</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">player1_aces =</span> <span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, tennis_data<span class="sc">$</span>w_ace, tennis_data<span class="sc">$</span>l_ace),</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">player1_double_faults =</span> <span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, tennis_data<span class="sc">$</span>w_df, tennis_data<span class="sc">$</span>l_df),</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Informations sur le joueur 2</span></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">player2_rank_points =</span> <span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, tennis_data<span class="sc">$</span>loser_rank_points, tennis_data<span class="sc">$</span>winner_rank_points),</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">player2_age =</span> <span class="fu">round</span>(<span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, tennis_data<span class="sc">$</span>loser_age, tennis_data<span class="sc">$</span>winner_age),<span class="dv">1</span>),</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">player2_hand =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, <span class="fu">as.character</span>(tennis_data<span class="sc">$</span>loser_hand),</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as.character</span>(tennis_data<span class="sc">$</span>winner_hand)),<span class="at">levels=</span><span class="fu">levels</span>(tennis_data<span class="sc">$</span>winner_hand)),</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">player2_aces =</span> <span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, tennis_data<span class="sc">$</span>l_ace, tennis_data<span class="sc">$</span>w_ace),</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">player2_double_faults =</span> <span class="fu">ifelse</span>(tennis_data<span class="sc">$</span>is_player1_winner, tennis_data<span class="sc">$</span>l_df, tennis_data<span class="sc">$</span>w_df),</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Variable cible</span></span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">player1_wins =</span> <span class="fu">as.factor</span>(tennis_data<span class="sc">$</span>is_player1_winner)</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="nettoyage-des-données" class="level2">
<h2 class="anchored" data-anchor-id="nettoyage-des-données">Nettoyage des données</h2>
<p>On retire les lignes avec des données manquantes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> new_data <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Le jeu de données ainsi construit est le suivant :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualiser le jeux de données</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co">#View(new_data)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Vérifier la structure</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(new_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   342 obs. of  15 variables:
 $ tourney_level        : Factor w/ 3 levels "A","D","G": 1 1 1 1 1 1 1 1 1 1 ...
 $ surface              : Factor w/ 3 levels "Carpet","Clay",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ round                : Factor w/ 8 levels "F","QF","R128",..: 1 8 8 2 2 2 2 4 4 4 ...
 $ minutes              : int  108 87 101 140 124 61 156 69 55 89 ...
 $ player1_rank_points  : int  2035 2035 4905 3300 2035 689 1001 864 3300 3415 ...
 $ player1_age          : num  25.6 25.6 27 30.6 25.6 22.7 22 24.4 30.6 23.3 ...
 $ player1_hand         : Factor w/ 4 levels "","L","R","U": 3 3 3 2 3 3 3 3 2 3 ...
 $ player1_aces         : int  7 4 1 4 3 1 2 0 1 11 ...
 $ player1_double_faults: int  2 1 1 0 3 2 2 1 2 1 ...
 $ player2_rank_points  : int  4905 5450 5315 5450 3415 4905 5315 5450 874 320 ...
 $ player2_age          : num  27 26 31.8 26 23.3 27 31.8 26 29.4 29.2 ...
 $ player2_hand         : Factor w/ 4 levels "","L","R","U": 3 3 3 3 3 3 3 3 2 3 ...
 $ player2_aces         : int  4 4 9 23 6 3 11 12 2 11 ...
 $ player2_double_faults: int  0 3 2 3 5 0 3 1 2 1 ...
 $ player1_wins         : Factor w/ 2 levels "FALSE","TRUE": 2 2 2 1 2 1 1 1 2 2 ...
 - attr(*, "na.action")= 'omit' Named int [1:46] 97 108 113 116 138 139 190 270 275 277 ...
  ..- attr(*, "names")= chr [1:46] "97" "108" "113" "116" ...</code></pre>
</div>
</div>
</section>
<section id="préparation-des-jeux-dentrainement-et-de-validation" class="level2">
<h2 class="anchored" data-anchor-id="préparation-des-jeux-dentrainement-et-de-validation">Préparation des jeux d’entrainement et de validation</h2>
<p>Séparation du jeux de données en deux échantillons de même taille : celui d’entrainement ou d’apprentissage et celui de test ou validation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> new_data <span class="sc">|&gt;</span> <span class="fu">initial_split</span>(<span class="at">strata=</span>player1_wins,<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>data_train <span class="ot">&lt;-</span> <span class="fu">training</span>(data_split) <span class="co"># Entrainement </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>data_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(data_split) <span class="co"># Evaluation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Durant ce projet, trois principales méthodes d’apprentissage statistique seront testées pour prédire le vainqueur des matchs de tennis :</p>
<ul>
<li><p>L’algorithme de régression <strong>LASSO</strong> (<strong>L</strong>east <strong>A</strong>bsolute <strong>S</strong>hrinkage and <strong>S</strong>election <strong>O</strong>perator)</p>
<p>Il s’agit d’une méthode derégression régularisée qui permet simultanément d’effectuer une sélection de variables et une estimation des coefficients. Cette méthode permet de gérer efficacement un grand nombre de variables explicatives, tout en évitant le surapprentissage. Elle permet également d’identifier les facteurs les plus importants dans la prédiction d’un match de tennis.</p></li>
<li><p>Les <strong>Forêts aléatoires</strong> (Random Forest)</p>
<p>Il s’agit d’une méthode basée sur la construction de plusieurs arbres de décision. Elle permet de capturer des relations non linéaires entre les variables (comme l’interaction entre le nombre d’aces et la surface du terrain par exemple).</p></li>
<li><p>Algorithme de <strong>Boosting (</strong>plus particulièrement <strong>XGBoost</strong> (e<strong>X</strong>treme <strong>G</strong>radient <strong>B</strong>oosting))</p>
<p>Il s’agit d’une méthode d’ensemble qui construit séquentiellement des modèles en se concentrant sur les erreurs des modèles précédents. Cette méthode est souvent très performante pour les problèmes de classification binaire et offre une bonne capacité de génétralisation.</p></li>
</ul>
<p>Ainsi, ces trois approches apportent des informations complémentaires qui peuvent être intéressantes pour répondre à notre objectif. Le LASSO offre une grande interprétabilité et une sélection automatique des variables pertinentes. Les forêts aléatoires excellent dans la capture des interactions complexes entre variables. Et enfin, le Boosting permet souvent d’obtenir des performances prédictives très élevées.</p>
<p>Pour comparer ces modèles, deux métriques principales seront utilisées :</p>
<ul>
<li><p>L’<strong>accuracy</strong> : Elle mesure la proportion de bonnes prédictions parmi l’ensemble des prédictions. Dans notre cas, il s’agit du pourcentage de matchs dont le résultat a été correctement prédit.</p></li>
<li><p>Le coefficient de <strong>Kappa</strong> : C’est une métrique plus robuste qui permet de s’affranchir des biais liés au hasard. Pour cela, il compare l’accuracy observée avec celle qui serait attendue par hasard. Plus ce coefficient se rapproche de 1, plus il y a un accord parfait entre les prédictions et les valeurs réelles. Une valeur de 0 indique au contraire que l’accord entre les valeurs prédites et les valeurs réelles équivaut au hasard. Dans notre cas, cette métrique est interressante, car dans le contexte du sport, de nombreux facteurs imprévisibles peuvent influencer le résultat, il est donc important de vérifier que le modèle est meilleur qu’une prédiction aléatoire.</p></li>
</ul>
</section>
<section id="algorithme-de-régression-lasso" class="level1">
<h1>Algorithme de régression LASSO</h1>
<section id="préparation-du-recipe-et-du-modèle" class="level2">
<h2 class="anchored" data-anchor-id="préparation-du-recipe-et-du-modèle">Préparation du recipe et du modèle</h2>
<p>On commence par créer un recipe qui standardise les données et gère les variables catégorielles.</p>
<p>Les variables qualitatives sont en effet transformées en variables indicatrices.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>lasso_recipe <span class="ot">&lt;-</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(<span class="at">formula =</span> player1_wins <span class="sc">~</span> ., <span class="at">data=</span>data_train) <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_novel</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#zero value : enlever les variables qui prennent 0 valeurs</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On configure le modèle de régression logistique avec pénalisation LASSO (en indiquant mixture=1).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>lasso_model <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_args</span>(<span class="at">mixture =</span> <span class="dv">1</span>, <span class="at">penalty =</span> <span class="fu">tune</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="préparation-du-workflow" class="level2">
<h2 class="anchored" data-anchor-id="préparation-du-workflow">Préparation du workflow</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>lasso_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(lasso_recipe) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sélection-du-paramètre-de-régularisation-lambda-par-validation-croisée" class="level2">
<h2 class="anchored" data-anchor-id="sélection-du-paramètre-de-régularisation-lambda-par-validation-croisée">Sélection du paramètre de régularisation (<span class="math inline">\(\lambda\)</span>) par validation croisée</h2>
<p>On commence par choisir une grille d’hyperparamètres (paramètre de régularisation <span class="math inline">\(\lambda\)</span> ).</p>
<p>Cette grille a été ajustée afin de pouvoir sélectionner au mieux le paramètre de régularisation, et de visualiser l’impact de sa valeur sur les performances du modèle.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>parameters_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>,<span class="sc">-</span><span class="dv">1</span>)), <span class="at">levels =</span> <span class="dv">200</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>parameters_grid</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 × 1
       penalty
         &lt;dbl&gt;
 1 0.0000001  
 2 0.000000107
 3 0.000000115
 4 0.000000123
 5 0.000000132
 6 0.000000141
 7 0.000000152
 8 0.000000163
 9 0.000000174
10 0.000000187
# ℹ 190 more rows</code></pre>
</div>
</div>
<p>On crée les blocs de la validation croisée 5 blocs répétée 5 fois :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data_folds <span class="ot">&lt;-</span><span class="fu">vfold_cv</span>(data_train, <span class="at">v=</span><span class="dv">5</span>, <span class="at">repeats=</span><span class="dv">5</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>lasso_cv <span class="ot">&lt;-</span> lasso_wf <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> data_folds, <span class="at">grid =</span> parameters_grid, <span class="at">metrics =</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>lasso_cv_metrics <span class="ot">&lt;-</span> lasso_cv <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>lasso_cv_metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 × 7
       penalty .metric  .estimator  mean     n std_err .config               
         &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                 
 1 0.0000001   accuracy binary     0.747    25  0.0153 Preprocessor1_Model001
 2 0.000000107 accuracy binary     0.747    25  0.0153 Preprocessor1_Model002
 3 0.000000115 accuracy binary     0.747    25  0.0153 Preprocessor1_Model003
 4 0.000000123 accuracy binary     0.747    25  0.0153 Preprocessor1_Model004
 5 0.000000132 accuracy binary     0.747    25  0.0153 Preprocessor1_Model005
 6 0.000000141 accuracy binary     0.747    25  0.0153 Preprocessor1_Model006
 7 0.000000152 accuracy binary     0.747    25  0.0153 Preprocessor1_Model007
 8 0.000000163 accuracy binary     0.747    25  0.0153 Preprocessor1_Model008
 9 0.000000174 accuracy binary     0.747    25  0.0153 Preprocessor1_Model009
10 0.000000187 accuracy binary     0.747    25  0.0153 Preprocessor1_Model010
# ℹ 190 more rows</code></pre>
</div>
</div>
<p>On trace l’évolution des performances du modèle (selon la métrique accuracy) lorsque l’on fait varier le paramètre <span class="math inline">\(\lambda\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>lasso_cv_metrics <span class="sc">|&gt;</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(penalty, mean, <span class="at">color =</span> .metric)) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Projet_LEGALL_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>lasso_cv_metrics <span class="sc">|&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(penalty, mean, <span class="at">color =</span> .metric)) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> std_err,<span class="at">ymax =</span> mean <span class="sc">+</span> std_err),</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Projet_LEGALL_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On entraine ensuite l’algorithme de regression LASSO avec le “meilleur” paramètre <span class="math inline">\(\lambda\)</span> (ajusté par VC) sur le jeu de données d’entrainement, pour construir le prédicteur final :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>best_parameter <span class="ot">&lt;-</span> lasso_cv <span class="sc">|&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">"accuracy"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>final_lasso_wf <span class="ot">&lt;-</span> lasso_wf<span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_parameter)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>best_lasso_fit <span class="ot">&lt;-</span> final_lasso_wf <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(data_train)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>best_lasso_fit <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 3
   term                  estimate penalty
   &lt;chr&gt;                    &lt;dbl&gt;   &lt;dbl&gt;
 1 (Intercept)             0.0916  0.0267
 2 minutes                 0       0.0267
 3 player1_rank_points     0.444   0.0267
 4 player1_age             0.0626  0.0267
 5 player1_aces            0.350   0.0267
 6 player1_double_faults  -0.0819  0.0267
 7 player2_rank_points    -0.501   0.0267
 8 player2_age            -0.0484  0.0267
 9 player2_aces           -0.780   0.0267
10 player2_double_faults   0.378   0.0267
# ℹ 17 more rows</code></pre>
</div>
</div>
<p>On remarque que l’algorithme de régression LASSO (avec l’hyperparamètre <span class="math inline">\(\lambda\)</span> ajusté par VC) pousse plusieurs coefficients de régression à <span class="math inline">\(0\)</span> . Une sélection de variable s’est opérée de façon mécanique.</p>
</section>
<section id="evaluation-des-performances-du-modèle" class="level2">
<h2 class="anchored" data-anchor-id="evaluation-des-performances-du-modèle">Evaluation des performances du modèle</h2>
<p>On évalue les performances de ce modèle :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">augment</span>(best_lasso_fit, <span class="at">new_data =</span> data_test)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>predictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 171 × 18
   .pred_class .pred_FALSE .pred_TRUE tourney_level surface round minutes
   &lt;fct&gt;             &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;         &lt;fct&gt;   &lt;fct&gt;   &lt;int&gt;
 1 FALSE             0.621     0.379  A             Hard    F         108
 2 FALSE             0.571     0.429  A             Hard    SF         87
 3 FALSE             0.909     0.0912 A             Hard    QF        140
 4 FALSE             0.830     0.170  A             Hard    QF        156
 5 FALSE             0.882     0.118  A             Hard    R16        69
 6 FALSE             0.631     0.369  A             Hard    R16        65
 7 TRUE              0.379     0.621  A             Hard    R16       158
 8 FALSE             0.608     0.392  A             Hard    R16       143
 9 TRUE              0.414     0.586  A             Hard    R16        59
10 TRUE              0.450     0.550  A             Hard    R32        67
# ℹ 161 more rows
# ℹ 11 more variables: player1_rank_points &lt;int&gt;, player1_age &lt;dbl&gt;,
#   player1_hand &lt;fct&gt;, player1_aces &lt;int&gt;, player1_double_faults &lt;int&gt;,
#   player2_rank_points &lt;int&gt;, player2_age &lt;dbl&gt;, player2_hand &lt;fct&gt;,
#   player2_aces &lt;int&gt;, player2_double_faults &lt;int&gt;, player1_wins &lt;fct&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(best_lasso_fit, <span class="at">new_data =</span> data_test) <span class="sc">|&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.pred_class, .pred_FALSE, .pred_TRUE, player1_wins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 171 × 4
   .pred_class .pred_FALSE .pred_TRUE player1_wins
   &lt;fct&gt;             &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt;       
 1 FALSE             0.621     0.379  TRUE        
 2 FALSE             0.571     0.429  TRUE        
 3 FALSE             0.909     0.0912 FALSE       
 4 FALSE             0.830     0.170  FALSE       
 5 FALSE             0.882     0.118  FALSE       
 6 FALSE             0.631     0.369  FALSE       
 7 TRUE              0.379     0.621  FALSE       
 8 FALSE             0.608     0.392  FALSE       
 9 TRUE              0.414     0.586  TRUE        
10 TRUE              0.450     0.550  FALSE       
# ℹ 161 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer Accuracy</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>lasso_accuracy <span class="ot">&lt;-</span> predictions <span class="sc">|&gt;</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> player1_wins, <span class="at">estimate =</span> .pred_class) <span class="sc">|&gt;</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(.estimate)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculer Kappa</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>lasso_kappa <span class="ot">&lt;-</span> predictions <span class="sc">|&gt;</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kap</span>(<span class="at">truth =</span> player1_wins, <span class="at">estimate =</span> .pred_class) <span class="sc">|&gt;</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(.estimate)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>lasso_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Accuracy"</span>, <span class="st">"Kappa"</span>),</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(lasso_accuracy, lasso_kappa)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>lasso_metrics</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Metric     Value
1 Accuracy 0.7192982
2    Kappa 0.4349442</code></pre>
</div>
</div>
<p>On obtient une accuracy de 76% , ce score est relativement bon, mais peut sans doute être amélioré avec un meilleur modèle.</p>
</section>
</section>
<section id="forêts-aléatoires" class="level1">
<h1>Forêts aléatoires</h1>
<section id="mise-en-oeuvre-dune-forêt-aléatoire-avec-mtry5" class="level2">
<h2 class="anchored" data-anchor-id="mise-en-oeuvre-dune-forêt-aléatoire-avec-mtry5"><strong>Mise en oeuvre d’une forêt aléatoire avec mtry=5</strong></h2>
<p>On commence par mettre en oeuvre une forêt aléatoire avec le choix arbitraire de mtry=5.</p>
<p><code>mtry</code> est un paramètre du modèle Random Forest qui désigne le nombre de variable qui doivent être utilisées pour chaque arbre du modèle.</p>
<section id="préparation-du-recipe-et-du-modèle-1" class="level3">
<h3 class="anchored" data-anchor-id="préparation-du-recipe-et-du-modèle-1">Préparation du recipe et du modèle</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>data_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(player1_wins<span class="sc">~</span>.,<span class="at">data=</span>data_train)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>rfm5_model <span class="ot">&lt;-</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>(<span class="at">mtry=</span><span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">oob.error=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="préparation-du-workflow-et-entrainement-du-modèle" class="level3">
<h3 class="anchored" data-anchor-id="préparation-du-workflow-et-entrainement-du-modèle">Préparation du workflow et entrainement du modèle</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>rfm5_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rfm5_model) <span class="sc">|&gt;</span>   <span class="fu">add_recipe</span>(data_recipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>rfm5_fit <span class="ot">&lt;-</span> rfm5_wf <span class="sc">|&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(data_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluation-des-performances-du-modèle-1" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-des-performances-du-modèle-1">Evaluation des performances du modèle</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> rfm5_fit <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data=</span>data_test)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> data_test <span class="sc">|&gt;</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(prediction) <span class="sc">|&gt;</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rfm5_pred =</span> .pred_class)<span class="sc">|&gt;</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth=</span>player1_wins, <span class="at">estimate=</span>rfm5_pred)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>results</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.696
2 kap      binary         0.391</code></pre>
</div>
</div>
<p>On remarque que les résultats sont similaires à ceux obtenus par régression LASSO.</p>
<p>Le coefficient Kappa apporte une information interréssante également car il permet d’éviter les biais liés au hasard. L’accord entre les prédictions et la réalité est pour l’instant moyen, laissant une marge d’amélioration.</p>
<p>Pour améliorer ces résultats, on ajuste la valeur de <code>mtry</code> par validation croisée (VC).</p>
</section>
</section>
<section id="mise-en-oeuvre-dune-forêt-aléatoire-avec-choix-du-meilleur-paramètre-mtry-par-vc" class="level2">
<h2 class="anchored" data-anchor-id="mise-en-oeuvre-dune-forêt-aléatoire-avec-choix-du-meilleur-paramètre-mtry-par-vc"><strong>Mise en oeuvre d’une forêt aléatoire avec choix du meilleur paramètre mtry par VC</strong></h2>
<p>Pour ne plus choisir <code>mtry</code> arbitrairement, on l’ajuste par validation croisée.</p>
<section id="modification-du-modèle" class="level3">
<h3 class="anchored" data-anchor-id="modification-du-modèle">Modification du modèle</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">mtry=</span><span class="fu">tune</span>()) <span class="sc">|&gt;</span>   </span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">oob.error=</span><span class="cn">FALSE</span>) <span class="sc">|&gt;</span>   </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>rf_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span>   <span class="fu">add_model</span>(rf_model) <span class="sc">|&gt;</span>   <span class="fu">add_recipe</span>(data_recipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sélection-du-paramètre-mtry-par-validation-croisée" class="level3">
<h3 class="anchored" data-anchor-id="sélection-du-paramètre-mtry-par-validation-croisée">Sélection du paramètre mtry par validation croisée</h3>
<p>On crée les blocs de la validation croisée (ici il s’agit d’une validation croisée 5 blocs répétée 5 fois) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>data_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(data_train,<span class="at">v=</span><span class="dv">5</span>,<span class="at">repeats=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Choix d’une grille d’hyperparamètres : pour commencer, on choisit une grille assez grossière</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>parameters_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mtry =</span> <span class="fu">seq</span>(<span class="dv">2</span>,<span class="dv">14</span>,<span class="at">by=</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mise en oeuvre de la validation croisée sur les blocs créés précédemment (<code>data_folds</code>) pour tous les hyperparamètres de la grille choisie (<code>parameters_grid</code>) avec la fonction <code>tune_grid</code> :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>rf_cv <span class="ot">&lt;-</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  rf_wf <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> data_folds, <span class="at">grid =</span> parameters_grid,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>accuracy,yardstick<span class="sc">::</span>kap))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'ranger' a été compilé avec la version R 4.4.2</code></pre>
</div>
</div>
<p>Représentation graphique des estimations par validation croisée des différents critères de performance (accuracy, kap) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>rf_cv <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Projet_LEGALL_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>On récupère la valeur du meilleur paramètre <code>mtry</code> au regard de l’accuracy.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>best_parameter <span class="ot">&lt;-</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  rf_cv <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric=</span><span class="st">"accuracy"</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>best_parameter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 2
   mtry .config             
  &lt;dbl&gt; &lt;chr&gt;               
1     2 Preprocessor1_Model1</code></pre>
</div>
</div>
<p>On entraine le modèle sur les données d’entrainement en utilisant la nouvelle valeur de <code>mtry</code>. Puis on test les performances du modèle sur l’échantillon de test.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>rf_best_fit <span class="ot">&lt;-</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  rf_wf <span class="sc">|&gt;</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_parameter) <span class="sc">|&gt;</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(data_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluation-des-performances-du-modèle-2" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-des-performances-du-modèle-2">Evaluation des performances du modèle</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> rf_best_fit <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data=</span>data_test)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>results_rf_vc <span class="ot">&lt;-</span> data_test <span class="sc">|&gt;</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(prediction) <span class="sc">|&gt;</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rf_pred =</span> .pred_class) <span class="sc">|&gt;</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> player1_wins, <span class="at">estimate =</span> rf_pred) </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>results_rf_vc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.696
2 kap      binary         0.390</code></pre>
</div>
</div>
<p>En choisissant la valeur de mtry par VC , on remarque que l’accuracy et le coefficient Kappa augmentent nettement par rapport à la valeur arbitraire précédemment choisie.</p>
</section>
</section>
<section id="mise-en-oeuvre-dune-forêt-aléatoire-avec-choix-du-meilleur-paramètre-mtry-par-erreur-out-of-bag-oob" class="level2">
<h2 class="anchored" data-anchor-id="mise-en-oeuvre-dune-forêt-aléatoire-avec-choix-du-meilleur-paramètre-mtry-par-erreur-out-of-bag-oob"><strong>Mise en oeuvre d’une forêt aléatoire avec choix du meilleur paramètre mtry par erreur Out of bag (OOB)</strong></h2>
<p>On s’intéresse maintenant à l’erreur Out Of Bag (OOB).</p>
<p>Mise en oeuvre de l’algorithme de forêt aléatoire avec les deux fonctions <code>randomForest</code> et <code>ranger</code>, avec les valeurs de paramètres (dont <code>mtry</code>) par défaut, et affichage de l’erreur OOB correspondante :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>(player1_wins<span class="sc">~</span>.,<span class="at">data=</span>data_train)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger::ranger(player1_wins ~ ., data = data_train) 

Type:                             Classification 
Number of trees:                  500 
Sample size:                      171 
Number of independent variables:  14 
Mtry:                             3 
Target node size:                 1 
Variable importance mode:         none 
Splitrule:                        gini 
OOB prediction error:             25.73 % </code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>rf<span class="sc">$</span>prediction.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2573099</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>(player1_wins<span class="sc">~</span>.,<span class="at">data=</span>data_train, <span class="at">num.trees =</span> <span class="dv">1000</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger::ranger(player1_wins ~ ., data = data_train, num.trees = 1000) 

Type:                             Classification 
Number of trees:                  1000 
Sample size:                      171 
Number of independent variables:  14 
Mtry:                             3 
Target node size:                 1 
Variable importance mode:         none 
Splitrule:                        gini 
OOB prediction error:             22.81 % </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>rf<span class="sc">$</span>prediction.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2280702</code></pre>
</div>
</div>
<p>On vérifie si on peut diminuer le nombre d’arbres dans la forêt :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>rf <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>(player1_wins<span class="sc">~</span>.,<span class="at">data=</span>data_train, <span class="at">num.trees =</span> <span class="dv">400</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>rf</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ranger result

Call:
 ranger::ranger(player1_wins ~ ., data = data_train, num.trees = 400) 

Type:                             Classification 
Number of trees:                  400 
Sample size:                      171 
Number of independent variables:  14 
Mtry:                             3 
Target node size:                 1 
Variable importance mode:         none 
Splitrule:                        gini 
OOB prediction error:             23.39 % </code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>rf<span class="sc">$</span>prediction.error</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2339181</code></pre>
</div>
</div>
<p>On obtient ici à peu près la même erreur OOB, on peut donc considérer que 400 arbres sont suffisants.</p>
<section id="ajustement-du-paramètre-mtry-par-erreur-out-of-bag" class="level3">
<h3 class="anchored" data-anchor-id="ajustement-du-paramètre-mtry-par-erreur-out-of-bag">Ajustement du paramètre <code>mtry</code> par erreur Out Of Bag</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>parameters_grid <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>OOB <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">14</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>) {</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  rf <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>(player1_wins <span class="sc">~</span> ., <span class="at">data =</span> data_train, <span class="at">mtry=</span>parameters_grid[i], <span class="at">num.trees=</span><span class="dv">400</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>  OOB[i]<span class="ot">&lt;-</span>rf<span class="sc">$</span>prediction.error</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>OOB</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.2748538 0.2397661 0.2514620 0.2865497 0.2397661 0.2573099 0.2631579
 [8] 0.2573099 0.2456140 0.2456140 0.2514620 0.2514620 0.2631579 0.2456140</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>,OOB,<span class="at">type=</span><span class="st">"l"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Projet_LEGALL_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>mtry_opt <span class="ot">&lt;-</span><span class="fu">which.min</span>(OOB)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>mtry_opt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2</code></pre>
</div>
</div>
<p>On définit le modèle avec le paramètre mtry ajusté par erreur OOB.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>rf_opt <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>(player1_wins <span class="sc">~</span> ., <span class="at">data =</span> data_train, <span class="at">mtry =</span> mtry_opt, <span class="at">probability=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluation-des-performances-du-modèle-sur-léchantillon-test" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-des-performances-du-modèle-sur-léchantillon-test">Evaluation des performances du modèle sur l’échantillon test</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_opt, <span class="at">data =</span> data_test)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred<span class="sc">$</span>predictions[, <span class="dv">2</span>] <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_class, <span class="at">levels=</span><span class="fu">c</span>(<span class="cn">FALSE</span>, <span class="cn">TRUE</span>))</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul des métriques</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>rf_oob_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(pred_class <span class="sc">==</span> data_test<span class="sc">$</span>player1_wins)</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Accuracy:"</span>, <span class="fu">round</span>(rf_oob_accuracy, <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Accuracy: 0.684"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul du Kappa</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>rf_oob_kappa <span class="ot">&lt;-</span> <span class="fu">cohen.kappa</span>(</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="fu">as.numeric</span>(pred_class), </span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as.numeric</span>(data_test<span class="sc">$</span>player1_wins)))<span class="sc">$</span>kappa</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Kappa:"</span>, <span class="fu">round</span>(rf_oob_kappa, <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Kappa: 0.367"</code></pre>
</div>
</div>
<p>On affiche la mesure d’importance par permutation des variables de la forêt ajustée :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>rf_importance_perm <span class="ot">&lt;-</span> ranger<span class="sc">::</span><span class="fu">ranger</span>(player1_wins <span class="sc">~</span> . , <span class="at">data =</span> data_train , <span class="at">mtry =</span> mtry_opt , <span class="at">importance=</span><span class="st">"permutation"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>rf_importance_perm<span class="sc">$</span>variable.importance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        tourney_level               surface                 round 
         0.0036681048         -0.0004245757          0.0007897200 
              minutes   player1_rank_points           player1_age 
         0.0087897541          0.0280923640          0.0032030680 
         player1_hand          player1_aces player1_double_faults 
         0.0029997362          0.0099705679          0.0006535672 
  player2_rank_points           player2_age          player2_hand 
         0.0426621997         -0.0002224591         -0.0002284446 
         player2_aces player2_double_faults 
         0.0321400244          0.0069250313 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>vip<span class="sc">::</span><span class="fu">vip</span>(rf_importance_perm, <span class="at">num_features=</span><span class="dv">14</span>L)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Projet_LEGALL_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Le nombre de points au ranking mondial et le nombre d’ace réalisés par les joueurs au cours du match semblent avoir la plus grande importance. Le nombre de doubles fautes réalisées par le joueur 2 se distingue également.</p>
</section>
</section>
</section>
<section id="algorithmes-de-boosting" class="level1">
<h1>Algorithmes de boosting</h1>
<p>On met en oeuvre de l’algorithme <code>xgboost</code> avec ajustement des hyperparamètres (nombre d’arbres, profondeur des arbres, paramètre de régularisation) à l’aide du package <code>tidymodels</code> :</p>
<section id="préparation-du-recipe-et-du-modèle-2" class="level2">
<h2 class="anchored" data-anchor-id="préparation-du-recipe-et-du-modèle-2">Préparation du recipe et du modèle</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>xgb_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(player1_wins <span class="sc">~</span> ., <span class="at">data =</span> data_train) <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>())</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="dv">1000</span> , <span class="at">stop_iter =</span> <span class="dv">20</span> , <span class="at">min_n =</span> <span class="dv">1</span> , <span class="at">tree_depth =</span> <span class="fu">tune</span>() , <span class="at">learn_rate =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="préparation-du-workflow-1" class="level2">
<h2 class="anchored" data-anchor-id="préparation-du-workflow-1">Préparation du workflow</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>xgb_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(xgb_recipe) <span class="sc">|&gt;</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(xgb_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ajustement-des-hyperparamètres-par-validation-croisée" class="level2">
<h2 class="anchored" data-anchor-id="ajustement-des-hyperparamètres-par-validation-croisée">Ajustement des hyperparamètres par validation croisée</h2>
<p>Choix de la grille d’hyperparamètres (profondeur des arbres et taux d’apprentissage) :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>xgb_parameters_grid <span class="ot">&lt;-</span> </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand.grid</span>(<span class="at">tree_depth=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>) , <span class="at">learn_rate =</span> <span class="fu">c</span>(<span class="fl">0.025</span>,<span class="fl">0.5</span>,<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On crée les blocs de la validation croisée 5 blocs répétée 5 fois :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>data_folds <span class="ot">&lt;-</span><span class="fu">vfold_cv</span>(data_train, <span class="at">v=</span><span class="dv">5</span>, <span class="at">repeats=</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>xgb_cv <span class="ot">&lt;-</span> xgb_wf <span class="sc">|&gt;</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> data_folds , <span class="at">grid =</span> xgb_parameters_grid, <span class="at">metrics =</span> <span class="fu">metric_set</span>(yardstick<span class="sc">::</span>accuracy))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: le package 'xgboost' a été compilé avec la version R 4.4.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>xgb_cv <span class="sc">|&gt;</span> <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Projet_LEGALL_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspecter tous les résultats de la validation croisée</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(xgb_cv) <span class="sc">|&gt;</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 8
   tree_depth learn_rate .metric  .estimator  mean     n std_err .config        
        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;          
 1          2      0.025 accuracy binary     0.740    25  0.0166 Preprocessor1_…
 2          3      0.025 accuracy binary     0.738    25  0.0137 Preprocessor1_…
 3          4      0.025 accuracy binary     0.733    25  0.0137 Preprocessor1_…
 4          5      0.025 accuracy binary     0.733    25  0.0145 Preprocessor1_…
 5          2      0.5   accuracy binary     0.727    25  0.0138 Preprocessor1_…
 6          5      1     accuracy binary     0.726    25  0.0145 Preprocessor1_…
 7          4      1     accuracy binary     0.725    25  0.0129 Preprocessor1_…
 8          4      0.5   accuracy binary     0.725    25  0.0155 Preprocessor1_…
 9          5      0.5   accuracy binary     0.722    25  0.0154 Preprocessor1_…
10          3      0.5   accuracy binary     0.720    25  0.0158 Preprocessor1_…
11          3      1     accuracy binary     0.709    25  0.0145 Preprocessor1_…
12          2      1     accuracy binary     0.708    25  0.0149 Preprocessor1_…</code></pre>
</div>
</div>
</section>
<section id="évaluation-des-performances-de-lalgorithme-xgboost-sur-léchantillon-test" class="level2">
<h2 class="anchored" data-anchor-id="évaluation-des-performances-de-lalgorithme-xgboost-sur-léchantillon-test">Évaluation des performances de l’algorithme <code>xgboost</code> sur l’échantillon test</h2>
<p>On commence par sélectionner les meilleurs paramètres en se basant sur la métrique <code>accuracy</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>best_parameters <span class="ot">&lt;-</span> xgb_cv <span class="sc">|&gt;</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="at">metric =</span> <span class="st">"accuracy"</span>)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(best_parameters)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  tree_depth learn_rate .config              
       &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                
1          2      0.025 Preprocessor1_Model01</code></pre>
</div>
</div>
<p>On finalise le workflow afin d’entrainer le modèle avec les meilleurs paramètres sur les données d’entrainement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>xgb_best_fit <span class="ot">&lt;-</span> xgb_wf <span class="sc">|&gt;</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_parameters) <span class="sc">|&gt;</span></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> data_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Pour vérifier les performances du modèle, on effectue des prédictions sur les données de test</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">&lt;-</span> </span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>  xgb_best_fit <span class="sc">|&gt;</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> data_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>On peut comparer ces prédictions aux valeurs réelles attendues :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>predictions_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">player1_wins =</span> data_test<span class="sc">$</span>player1_wins,  </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">xgb_pred =</span> prediction<span class="sc">$</span>.pred_class     </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(predictions_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 171 × 2
   player1_wins xgb_pred
   &lt;fct&gt;        &lt;fct&gt;   
 1 TRUE         FALSE   
 2 TRUE         TRUE    
 3 FALSE        FALSE   
 4 FALSE        FALSE   
 5 FALSE        FALSE   
 6 FALSE        FALSE   
 7 FALSE        FALSE   
 8 FALSE        FALSE   
 9 TRUE         FALSE   
10 FALSE        FALSE   
# ℹ 161 more rows</code></pre>
</div>
</div>
<p>Calculons maintenant les métriques <code>accuracy</code> et <code>kap</code> sur ces prédictions :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>xgb_metrics <span class="ot">&lt;-</span> predictions_df <span class="sc">|&gt;</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> player1_wins, <span class="at">estimate =</span> xgb_pred)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher les résultats des métriques</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(xgb_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.684
2 kap      binary         0.369</code></pre>
</div>
</div>
<p>Les performances de ce modèle sont similaires à celles obtenues avec les autres modèles, bien que légèrement inférieures.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<section id="comparaison-des-performances-des-modèles" class="level2">
<h2 class="anchored" data-anchor-id="comparaison-des-performances-des-modèles">Comparaison des performances des modèles</h2>
<p>Pour comparer plus facilement les modèles, on crée un tableau récapitulant leurs performances selon plusieurs métriques.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul des métriques pour chaque modèle</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>rf_vc_accuracy <span class="ot">&lt;-</span> results_rf_vc <span class="sc">|&gt;</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"accuracy"</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(.estimate)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>rf_vc_kappa <span class="ot">&lt;-</span> results_rf_vc <span class="sc">|&gt;</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"kap"</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(.estimate)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>xgb_accuracy <span class="ot">&lt;-</span> xgb_metrics<span class="sc">|&gt;</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"accuracy"</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(.estimate)</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>xgb_kappa <span class="ot">&lt;-</span> xgb_metrics<span class="sc">|&gt;</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">==</span> <span class="st">"kap"</span>) <span class="sc">|&gt;</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(.estimate)</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Créer le tableau comparatif</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>comparatif_models <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"LASSO"</span>, <span class="st">"Random Forest (VC)"</span>, <span class="st">"Random Forest (OOB)"</span>, <span class="st">"Boosting"</span>),</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">Accuracy =</span> <span class="fu">c</span>(</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>    lasso_accuracy,</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>    rf_vc_accuracy,</span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>    rf_oob_accuracy,</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>    xgb_accuracy</span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Kappa =</span> <span class="fu">c</span>(</span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>    lasso_kappa,</span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>    rf_vc_kappa,</span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>    rf_oob_kappa,</span>
<span id="cb102-31"><a href="#cb102-31" aria-hidden="true" tabindex="-1"></a>    xgb_kappa</span>
<span id="cb102-32"><a href="#cb102-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb102-33"><a href="#cb102-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb102-34"><a href="#cb102-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-35"><a href="#cb102-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher le tableau comparatif</span></span>
<span id="cb102-36"><a href="#cb102-36" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(comparatif_models)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Model  Accuracy     Kappa
1               LASSO 0.7192982 0.4349442
2  Random Forest (VC) 0.6959064 0.3901235
3 Random Forest (OOB) 0.6842105 0.3666667
4            Boosting 0.6842105 0.3690037</code></pre>
</div>
</div>
<p>Les trois méthodes testées montrent finalement des performances relativement proches, avec des taux de précision variant entre 71% et 78%. C’est une précision satisfaisante pour la prédiction de résultats sportifs. Il n’y a donc pas de méthode montrant une supériorité écrasante sur les autres.</p>
<p>Le modèle le plus performant est la forêt aléatoire optimisée par validation croisée, avec une accuracy de 77.8% et un coefficient Kappa de 0.55, indiquant une bonne capacité de prédiction au-delà du hasard. Le second modèle de forêts aléatoires montre des performances plutôt proches, ce qui confirme que cette méthode est robuste.</p>
<p>Le modèle LASSO obtient une performance très légèrement inférieure, avec 76% de précision. Il peut s’agir d’un bon compromis entre simplicité et performance.</p>
<p>Enfin, le Boosting présente les résultats les plus faibles avec une accuracy de 71.3% et un coefficient Kappa de 0.42. Ces résultats restent néanmoins satisfaisants.<br>
</p>
</section>
<section id="limites-et-perspectives" class="level2">
<h2 class="anchored" data-anchor-id="limites-et-perspectives">Limites et perspectives</h2>
<p>Les performance obtenues, bien que satisfantes, soulignent la complexité du sport de haut niveau. En effet, il reste une part importante de l’issue des matchs qui reste imprévisible.</p>
<p>Pour améliorer ces modèles, d’autres variables non présente dans ce jeu de données auraient pu être prises en compte, comme par exemple l’historique des confrontations entre les deux joueurs, ou encore l’état de forme des joueurs.</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
